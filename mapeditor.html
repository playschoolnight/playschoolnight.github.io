<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Map Editor</title>
  <style>
    body { font-family: monospace; padding: 16px; }
    .grid { display: grid; margin-top: 12px; }
    .cell {
      width: 20px;
      height: 20px;
      border: 1px solid #ccc;
      cursor: pointer;
    }
    .wall { background: black; }
  </style>
</head>
<body>
  <h3>Map Editor</h3>

  <button id="wall">Wall (#)</button>
  <button id="erase">Erase (.)</button>
  <button id="add">+ Map</button>
  <button id="export">Export</button>

  <div id="maps"></div>
  <div id="grid" class="grid"></div>

  <script>
    const WIDTH = 28;
    const HEIGHT = 18;

    const makeGrid = () =>
      Array.from({ length: HEIGHT }, () =>
        Array.from({ length: WIDTH }, () => '.')
      );

    let maps = [[makeGrid()]]; // [[[rows]]]
    let mapIndex = 0;
    let drawing = '#';
    let mouseDown = false;
    let lastCell = null;

    const gridEl = document.getElementById('grid');
    const mapsEl = document.getElementById('maps');

    window.onmouseup = () => {
      mouseDown = false;
      lastCell = null;
    };

    function renderMapButtons() {
      mapsEl.innerHTML = '';
      maps.forEach((_, i) => {
        const b = document.createElement('button');
        b.textContent = i;
        b.onclick = () => { mapIndex = i; render(); };
        mapsEl.appendChild(b);
      });
    }

    function render() {
      renderMapButtons();
      gridEl.innerHTML = '';
      gridEl.style.gridTemplateColumns = `repeat(${WIDTH}, 20px)`;

      maps[mapIndex][0].forEach((row, y) => {
        row.forEach((cell, x) => {
          const d = document.createElement('div');
          d.className = 'cell' + (cell === '#' ? ' wall' : '');

          d.onmousedown = () => {
            mouseDown = true;
            paint(y, x);
          };

          d.onmouseover = () => {
            if (mouseDown) paint(y, x);
          };

          gridEl.appendChild(d);
        });
      });
    }

    function paint(y, x) {
      const key = y + ',' + x;
      if (lastCell === key) return; // prevent re-painting same cell
      lastCell = key;

      maps[mapIndex][0][y][x] = drawing;
      render();
    }

    document.getElementById('wall').onclick = () => drawing = '#';
    document.getElementById('erase').onclick = () => drawing = '.';

    document.getElementById('add').onclick = () => {
      maps.push([makeGrid()]);
      mapIndex = maps.length - 1;
      render();
    };

    document.getElementById('export').onclick = async () => {
      const rows = maps[mapIndex][0].map(r => `"${r.join('')}"`).join(',\n');
      await navigator.clipboard.writeText(rows);
      alert('Copied to clipboard');
    };`;

      await navigator.clipboard.writeText(out);
      alert('Copied to clipboard');
    };

    render();
  </script>
</body>
</html>
